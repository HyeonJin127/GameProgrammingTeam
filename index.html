<!-- =========================
 File: event.html (ë©”ì¸ HTML)
 Note: ê°™ì€ í´ë”ì— intro.css ì™€ gamelogo.png ë¥¼ ë†“ì•„ì£¼ì„¸ìš”
========================== -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë˜ì „ ì˜¤ë¸Œ ë‹¤ì´ìŠ¤</title>
  <!-- ì™¸ë¶€ CSS ë¶„ë¦¬ -->
  <link rel="stylesheet" href="intro.css" />
</head>
<body>
  <!-- ìƒë‹¨ ì‚¬ìš´ë“œ í† ê¸€ ë²„íŠ¼ -->
  <div class="top-ui">
    <button id="sound" class="tiny-btn">ğŸ”Š SOUND</button>
  </div>

  <!-- ì¸íŠ¸ë¡œ ì»¨í…Œì´ë„ˆ -->
  <div class="intro" id="intro">
    <!-- ë¡œë”© ì™„ë£Œ í›„ ë“±ì¥í•  ê²Œì„ ë¡œê³  (ê°™ì€ í´ë”ì˜ gamelogo.png ë¥¼ ê°€ë¦¬í‚´) -->
    <img id="logo" src="./gamelogo.png" alt="ê²Œì„ ë¡œê³ " />

    <!-- ë¡œë”© ìƒíƒœ ë¬¸êµ¬: ë¡œë”© ì¤‘/ì™„ë£Œ ë¬¸êµ¬ê°€ ë™ì ìœ¼ë¡œ ê°±ì‹ ë¨ -->
    <div class="status" id="status">ìì›ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>

    <!-- ğŸ”¥ ìš©ì•” ê²Œì´ì§€ + ì£¼ì‚¬ìœ„ í† í° ë¡œë”©ë°” -->
    <div class="dice-bar" id="diceBar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="ë¡œë”© ì§„í–‰ë¥ ">
      <div class="track rock">
        <!-- ì§„í–‰ë¥  ì»¨í…Œì´ë„ˆ: width ë¡œ í¼ì„¼íŠ¸ ì œì–´ -->
        <div class="fill" id="fill">
          <!-- ìš©ì•” íë¦„/ë…¸ì´ì¦ˆ/ë²„ë¸” ë ˆì´ì–´ -->
          <div class="lava-flow"></div>
          <div class="lava-noise"></div>
          <div class="lava-bubbles" id="lavaBubbles"></div>
          <div class="lava-gloss"></div>
        </div>
      </div>

      <!-- ì§„í–‰ì„ ë”°ë¼ ì›€ì§ì´ëŠ” ì£¼ì‚¬ìœ„ í† í° -->
      <div class="token" id="token" aria-hidden="true">
        <svg class="die" viewBox="0 0 200 200" data-face="1">
          <rect x="10" y="10" width="180" height="180" rx="28" ry="28" fill="#fff" stroke="#111" stroke-width="6"></rect>
          <circle class="pip f1 f3 f5 f6" cx="50" cy="50" r="12"/>
          <circle class="pip f2 f3 f4 f5 f6" cx="150" cy="150" r="12"/>
          <circle class="pip f4 f5 f6" cx="150" cy="50" r="12"/>
          <circle class="pip f4 f5 f6" cx="50" cy="150" r="12"/>
          <circle class="pip f5" cx="100" cy="100" r="12"/>
          <circle class="pip f6" cx="50" cy="100" r="12"/>
          <circle class="pip f6" cx="150" cy="100" r="12"/>
        </svg>
        <div class="shadow" id="shadow"></div>
      </div>
    </div>
  </div>

  <!-- í´ë¦­(í„°ì¹˜) ì „í™˜ìš© íˆ¬ëª… ë² ì¼ & ê²Œì´íŠ¸ ì• ë‹ˆë©”ì´ì…˜ -->
  <div class="click-veil" id="veil" aria-hidden="true"></div>
  <div class="gate" id="gate"><div class="top"></div><div class="bottom"></div></div>

  <script>
    /* ========================
       ì¸íŠ¸ë¡œ ë¡œì§ (ë¡œë”© â†’ ì¤€ë¹„ì™„ë£Œ â†’ í´ë¦­ ì§„ì…)
       - ìš©ì•” ê²Œì´ì§€ ì§„í–‰ + ì£¼ì‚¬ìœ„ ì• ë‹ˆë©”ì´ì…˜
       - 100% ì‹œ íš¨ê³¼ìŒ + ë¡œê³  í˜ì´ë“œì¸/í™•ëŒ€
       - í™”ë©´ ì–´ë””ë“  í´ë¦­/í„°ì¹˜/Enter/Space ë¡œ ì§„ì…
    =========================*/

    // DOM ì°¸ì¡°
    const fill = document.getElementById('fill');
    const soundBtn = document.getElementById('sound');
    const statusEl = document.getElementById('status');
    const token = document.getElementById('token');
    const die = token.querySelector('.die');
    const shadow = document.getElementById('shadow');
    const logo = document.getElementById('logo');
    const diceBar = document.getElementById('diceBar');
    const veil = document.getElementById('veil');
    const gate = document.getElementById('gate');
    const intro = document.getElementById('intro');
    const bubbles = document.getElementById('lavaBubbles');

    // ì£¼ì‚¬ìœ„ ëˆˆ í‘œì‹œ í—¬í¼
    function setFace(n){
      die.querySelectorAll('.pip').forEach(el=>{
        el.style.display = el.classList.contains('f'+n) ? 'block' : 'none';
      });
    }

    // í† í°(ì£¼ì‚¬ìœ„) ìœ„ì¹˜/í”ë“¤ë¦¼ ì—…ë°ì´íŠ¸ - ë°”ì˜ ë‚´ë¶€ì—ì„œë§Œ ì´ë™
    function updateTokenPosition(percentage){
      const bw  = diceBar.clientWidth;           // ë°” ë„ˆë¹„(px)
      const tw  = token.offsetWidth || 44;       // ì£¼ì‚¬ìœ„ ë„ˆë¹„(px)
      const minCenter = tw / 2;                  // ì¢Œì¸¡ ì—¬ìœ í­
      const maxCenter = bw - tw / 2;             // ìš°ì¸¡ ì—¬ìœ í­
      const centerX = minCenter + (maxCenter - minCenter) * (percentage / 100);

      token.style.left = centerX + 'px';
      token.style.transform = `translate(-50%, -50%) rotate(${percentage*3}deg)`;

      // ê°€ë²¼ìš´ ìœ„ì•„ë˜ ë°”ìš´ìŠ¤
      const bob = Math.sin(percentage/100 * Math.PI * 2) * 6;
      token.style.transform += ` translateY(${-Math.abs(bob)}px)`;

      // ê·¸ë¦¼ì í¬ê¸°/íˆ¬ëª…ë„ ë³´ì • (ì£¼ì‚¬ìœ„ í¬ê¸°ì— ë¹„ë¡€)
      const baseShadowW = Math.max(8, Math.round(tw));
      shadow.style.width = (baseShadowW - Math.abs(bob)*0.9) + 'px';
      shadow.style.height = Math.max(8, Math.round(tw * 0.16)) + 'px';
      shadow.style.opacity = 1 - Math.abs(bob)/18;
    }

    // ìš©ì•” ë²„ë¸” ìƒì„± (ì§„í–‰ ì¤‘ì—ë§Œ ëª½ê¸€ëª½ê¸€)
    let bubbleTimer = null;
    function spawnBubble(){
      const b = document.createElement('span');
      b.className = 'bubble';
      const x = Math.random()*100; // % ê¸°ì¤€
      const s = 6 + Math.random()*10; // px
      b.style.left = x + '%';
      b.style.width = s + 'px';
      b.style.height = s + 'px';
      const dur = 1000 + Math.random()*1400;
      bubbles.appendChild(b);
      b.animate([
        { transform:'translate(-50%, 6px) scale(.8)', opacity:.0 },
        { transform:'translate(-50%, -26px) scale(1)', opacity:.9, offset:.2 },
        { transform:'translate(-50%, -58px) scale(.9)', opacity:0 }
      ], { duration: dur, easing:'cubic-bezier(.3,.8,.2,1)'});
      setTimeout(()=> b.remove(), dur+30);
    }

    // ì‚¬ìš´ë“œ ë§¤ë‹ˆì € (ê°„ë‹¨í•œ ë¹„í”„/ë¶ˆ ì†Œë¦¬)
    const AudioMgr = (()=>{
      let ctx=null, gain=null, enabled=true;
      function ensure(){
        if(!ctx){ ctx = new (window.AudioContext||window.webkitAudioContext)();
          gain = ctx.createGain(); gain.gain.value = 0.7; gain.connect(ctx.destination); }
      }
      async function resume(){ if(ctx && ctx.state==='suspended') await ctx.resume(); }
      function beep(freq=880, dur=.06){ if(!enabled) return; ensure();
        const o=ctx.createOscillator(), g=ctx.createGain(); o.type='sine'; o.frequency.value=freq;
        o.connect(g); g.connect(gain);
        g.gain.setValueAtTime(0.0001, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.28, ctx.currentTime+.01);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+dur);
        o.start(); o.stop(ctx.currentTime+dur);
      }
      function fire(){ if(!enabled) return; ensure(); for(let i=0;i<5;i++){ beep(300+Math.random()*200, 0.08); } }
      function toggle(){ enabled=!enabled; beep(enabled?780:420,.05); soundBtn.textContent = enabled? 'ğŸ”Š SOUND' : 'ğŸ”‡ MUTE'; }
      return {beep, fire, toggle, resume};
    })();

    // ìƒë‹¨ ì‚¬ìš´ë“œ í† ê¸€
    soundBtn.addEventListener('click', async()=>{ await AudioMgr.resume(); AudioMgr.toggle(); });

    // ë¡œë”© ì‹œë®¬ë ˆì´ì…˜ + ì£¼ì‚¬ìœ„ ë¡¤ë§
    let load=0, ready=false, rollIndex=1; setFace(1);
    const rollTimer = setInterval(()=>{ rollIndex = (rollIndex%6)+1; setFace(rollIndex); }, 120);

    const timer = setInterval(()=>{
      load = Math.min(100, load + (load<75? Math.random()*8 : Math.random()*3 + 1));
      fill.style.width = load + '%';
      updateTokenPosition(load);

      // ì§„í–‰ ì¤‘ ë²„ë¸” í‹±
      if(!bubbleTimer){ bubbleTimer = setInterval(spawnBubble, 180); }

      if(load>35 && load<70) statusEl.textContent='ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦¬ëŠ” ì¤‘â€¦';
      if(load>=70 && load<100) statusEl.textContent='ë˜ì „ ë¬¸ì„ ì—¬ëŠ” ì¤‘â€¦';

      if(load>=100){
        clearInterval(timer); clearInterval(rollTimer); clearInterval(bubbleTimer);
        setFace(6); updateTokenPosition(100);
        AudioMgr.fire();
        // ë¡œê³  í¬ê²Œ ë“±ì¥ + ë°” ìˆ¨ê¸°ê¸° + í´ë¦­ ê°€ëŠ¥
        diceBar.classList.add('hidden');
        requestAnimationFrame(()=>{ logo.classList.add('show'); });
        statusEl.textContent='ë¡œë”© ì™„ë£Œ! í„°ì¹˜ í•´ì„œ ì ‘ì†í•˜ì„¸ìš”!';
        statusEl.classList.add('ready');
        veil.classList.add('on');
        ready = true;
      }
    }, 95);

    // ì§„ì… ì²˜ë¦¬(ê²Œì´íŠ¸ ì˜¤í”ˆ â†’ ë‹¤ìŒ í™”ë©´)
    function openGateAndEnter(){
      // ë¡œê³ /ì¸íŠ¸ë¡œê°€ ê²Œì´íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ë™ì•ˆ ë³´ì´ì§€ ì•Šë„ë¡ ì¦‰ì‹œ ìˆ¨ê¹€
      veil.classList.remove('on');
      intro.style.visibility = 'hidden';
      intro.style.opacity = '0';

      // ê²Œì´íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
      gate.classList.add('open');

      // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ ë°”ë¡œ ë‹¤ìŒ í™”ë©´ìœ¼ë¡œ ì „í™˜
      setTimeout(()=>{
        document.body.innerHTML = '<div style="display:grid;place-items:center;height:100vh;background:var(--bg);color:#fff;font-size:2.5rem;font-weight:900;">ë˜ì „ ì…ì¥!</div>';
      }, 720);
    } 720;
    
    async function tryEnter(){ if(!ready) return; await AudioMgr.resume(); AudioMgr.beep(1200,.12); openGateAndEnter(); }
    veil.addEventListener('click', tryEnter);
    intro.addEventListener('click', tryEnter);
    document.addEventListener('keydown', (e)=>{ if(ready && (e.key==='Enter' || e.key===' ')) tryEnter(); });
  </script>
</body>
</html>


